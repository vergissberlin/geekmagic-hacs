# Requires: uv installed globally (curl -LsSf https://astral.sh/uv/install.sh | sh)
# Local hooks use `uv run` to leverage uv.lock for exact dependency versions.
repos:
  - repo: https://github.com/astral-sh/uv-pre-commit
    rev: 0.7.12
    hooks:
      - id: uv-lock
        name: uv lock (sync pyproject.toml â†’ uv.lock)

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.9
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: local
    hooks:
      - id: ty
        name: ty type checker (via uv)
        entry: uv run ty check
        language: system
        types: [python]
        pass_filenames: false

      - id: pytest
        name: pytest (via uv)
        entry: uv run pytest
        language: system
        types: [python]
        pass_filenames: false
        stages: [pre-commit]

      - id: frontend-typecheck
        name: frontend typecheck
        entry: bash -c 'cd custom_components/geekmagic/frontend && npm run typecheck'
        language: system
        pass_filenames: false
        files: ^custom_components/geekmagic/frontend/src/.*\.ts$

      - id: frontend-dist-check
        name: frontend dist check
        entry: ./scripts/check-frontend-dist.sh
        language: script
        pass_filenames: false
        stages: [pre-commit]

      - id: check-translations
        name: check entity translations
        entry: uv run python scripts/check_translations.py
        language: system
        pass_filenames: false
        files: ^custom_components/geekmagic/(entities/.*\.py|strings\.json)$
